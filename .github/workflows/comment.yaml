name: Call from issue-comment

on:
  issue_comment:
    types: [created]

jobs:
  job:
    if: contains(github.event.comment.html_url, '/pull/') && startsWith(github.event.comment.body, '/preview')
    runs-on: ubuntu-latest
    steps:
    - name: get upstream branch
      id: upstreambranch
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "::set-output name=branchname::$(curl -H "Authorization: token ${GITHUB_TOKEN}" ${{ github.event.issue.pull_request.url }} | jq '.head.ref' | sed 's/\"//g')"
    - name: Checkout upstream repo
      uses: actions/checkout@v2
      with:
        ref: ${{ steps.upstreambranch.outputs.branchname }}
    - name: print
      run: |
        echo ${{ steps.upstreambranch.outputs.branchname }}
        echo ${{ github.event.path }}
        echo $(cat ${{ github.event.path }} | jq '.number')
