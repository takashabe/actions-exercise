name: Call from issue-comment

on:
  issue_comment:
    types: [created]
  push:

jobs:
  job:
    if: contains(github.event.comment.html_url, '/pull/') && startsWith(github.event.comment.body, '/preview')
    runs-on: ubuntu-latest
    steps:
    - name: get upstream branch
      id: upstreambranch
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        url="https://api.github.com/repos/takashabe/actions-exercise/pulls/88"
        result=$(curl -H "Authorization: token ${GITHUB_TOKEN}" $url)
        echo $result
        echo $result | jq '.head.ref' | sed 's/\"//g')"
    - name: Checkout upstream repo
      uses: actions/checkout@v2
      with:
        ref: ${{ steps.upstreambranch.outputs.branchname }}
    - name: print
      run: |
        echo ${{ steps.upstreambranch.outputs.branchname }}
        echo ${{ github.event.path }}
        echo $(cat ${{ github.event.path }} | jq '.number')
