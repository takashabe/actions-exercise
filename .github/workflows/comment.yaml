name: Call from issue-comment

on:
  issue_comment:
    types: [created]

jobs:
  job:
    if: contains(github.event.comment.html_url, '/pull/') && startsWith(github.event.comment.body, '/preview')
    runs-on: ubuntu-latest
    steps:
    - name: get upstream branch
      id: upstreambranch
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        url="https://api.github.com/repos/takashabe/actions-exercise/pulls/88"

        result=$(curl -H "Authorization: token ${GITHUB_TOKEN}" $url)

        echo $(echo $result | jq '.head.ref' | sed 's/\"//g')
        echo "::set-output name=branch::$(echo $result | jq '.head.ref' | sed 's/\"//g')"
        echo "::set-output name=pr_number::$(echo $result | jq '.number')"
    - name: print
      run: |
        echo ${{ github.event.comment.body }}
        echo ${{ steps.upstreambranch.outputs.branch }}
        echo ${{ steps.upstreambranch.outputs.pr_number }}
